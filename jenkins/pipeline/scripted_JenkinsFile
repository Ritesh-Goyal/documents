node {
	stage("Get Application Code"){
		git branch: 'main', credentialsId: 'github-access', url: 'git@github.com:Ritesh-Goyal/restro-project.git'
	}
	stage("Build"){
		def mvnHome = tool 'MVN'
		withEnv(["MVN_HOME=$mvnHome"]) {
			sh '"$MVN_HOME/bin/mvn" clean compile package'
		}
	}
	stage("Deploy the Application"){
		sh 'scp -i /var/lib/jenkins/.ssh/id_rsa -o StrictHostKeyChecking=no target/*war ec2-user@172.31.3.212:/home/ec2-user/apps/tomcat/webapps/'
	}
	stage("Notification"){
	   emailext attachLog: true, body: '''$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS:

Check console output at $BUILD_URL to view the results.''', subject: '$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!' 
	}
}
